name: Generate and Deploy Documentation

on:
  push:
    branches: [ main ]  # Change to your default branch if different
  workflow_dispatch:  # Allows manual triggering

permissions:
  contents: write

jobs:
  build-and-deploy:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout repository
        uses: actions/checkout@v4

      - name: Set up Python
        uses: actions/setup-python@v5
        with:
          python-version: '3.10'

      - name: Install documentation dependencies
        run: |
          python -m pip install --upgrade pip
          pip install mkdocs mkdocs-material mkdocstrings mkdocstrings-python

      - name: Create mkdocs.yml
        run: |
          cat > mkdocs.yml << EOF
          site_name: DataVerse-ChatBot Documentation
          site_description: Documentation for the DataVerse-ChatBot project
          theme:
            name: material
            palette:
              primary: indigo
              accent: indigo
          plugins:
            - search
            - mkdocstrings:
                handlers:
                  python:
                    paths: ["."]  # Look for modules in the current directory
                    options:
                      show_source: true
                      docstring_style: google
                      docstring_section_style: spacy
          nav:
            - Home: index.md
            - API Reference:
              - Overview: api/index.md
              - Chatbot: api/chatbot.md
              - RAG: api/rag.md
              - Embeddings: api/embeddings.md
              - Utils: api/utils.md
          EOF

      - name: Create documentation structure
        run: |
          mkdir -p docs/api
          
          # Create index page
          cat > docs/index.md << EOF
          # DataVerse-ChatBot
          
          Welcome to the DataVerse-ChatBot documentation.
          
          This site contains the API documentation for the DataVerse-ChatBot project.
          EOF
          
          # Create API overview page
          cat > docs/api/index.md << EOF
          # API Reference
          
          This section contains the API documentation for the DataVerse-ChatBot project.
          EOF
          
          # Create chatbot module documentation
          cat > docs/api/chatbot.md << EOF
          # Chatbot Module
          
          ## Config
          
          ::: src.chatbot.config
          
          ## Crawler
          
          ::: src.chatbot.crawler
                  
          ## Voice Mode
          
          ::: src.chatbot.voice_mode
          EOF
          
          # Create RAG module documentation
          cat > docs/api/rag.md << EOF
          # RAG Module
          
          ## Base RAG
          
          ::: src.chatbot.rag.base_rag
          
          ## Claude RAG
          
          ::: src.chatbot.rag.claude_rag
                  
          ## Cohere RAG
          
          ::: src.chatbot.rag.cohere_rag
                  
          ## DeepSeek RAG
          
          ::: src.chatbot.rag.deepseek_rag
                  
          ## Gemini RAG
          
          ::: src.chatbot.rag.gemini_rag
                  
          ## Grok RAG
          
          ::: src.chatbot.rag.grok_rag
                  
          ## Mistral RAG
          
          ::: src.chatbot.rag.mistral_rag
                  
          ## OpenAI RAG
          
          ::: src.chatbot.rag.openai_rag
          EOF
          
          # Create Embeddings module documentation
          cat > docs/api/embeddings.md << EOF
          # Embeddings Module
          
          ## Base Embedding
          
          ::: src.chatbot.embeddings.base_embedding
          EOF
          
          # Create Utils module documentation
          cat > docs/api/utils.md << EOF
          # Utils Module
          
          ## File Loader
          
          ::: src.chatbot.utils.file_loader
          
          ## Inference
          
          ::: src.chatbot.utils.inference
                  
          ## Make Dataset
          
          ::: src.chatbot.utils.make_dataset
                  
          ## Monitor Service
          
          ::: src.chatbot.utils.monitor_service
                  
          ## Paths
          
          ::: src.chatbot.utils.paths
                  
          ## Train CLF
          
          ::: src.chatbot.utils.train_clf
                  
          ## Utils
          
          ::: src.chatbot.utils.utils
          EOF

      - name: Build documentation
        run: |
          mkdocs build

      - name: Deploy to GitHub Pages
        uses: JamesIves/github-pages-deploy-action@v4
        with:
          folder: site
          branch: gh-pages
