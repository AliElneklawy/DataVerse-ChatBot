name: Generate and Deploy Documentation

on:
  push:
    branches: [ main ]  # Change to your default branch if different
  workflow_dispatch:  # Allows manual triggering

permissions:
  contents: write

jobs:
  build-and-deploy:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout repository
        uses: actions/checkout@v4

      - name: Set up Python
        uses: actions/setup-python@v5
        with:
          python-version: '3.10'

      - name: Install documentation dependencies
        run: |
          python -m pip install --upgrade pip
          pip install mkdocs mkdocs-material mkdocstrings mkdocstrings-python

      - name: Create mkdocs.yml
        run: |
          cat > mkdocs.yml << EOF
          site_name: DataVerse-ChatBot Documentation
          site_description: Documentation for the DataVerse-ChatBot project
          theme:
            name: material
            palette:
              primary: indigo
              accent: indigo
          plugins:
            - search
            - mkdocstrings:
                handlers:
                  python:
                    options:
                      show_source: true
                      show_root_heading: true
          nav:
            - Home: index.md
            - API Reference:
              - Overview: api/index.md
              - Chatbot: api/chatbot.md
              - RAG: api/rag.md
              - Embeddings: api/embeddings.md
              - Utils: api/utils.md
              - Web: api/web.md
          EOF

      - name: Create documentation structure
        run: |
          mkdir -p docs/api
          
          # Create index page
          cat > docs/index.md << EOF
          # DataVerse-ChatBot
          
          Welcome to the DataVerse-ChatBot documentation.
          
          This site contains the API documentation for the DataVerse-ChatBot project.
          EOF
          
          # Create API overview page
          cat > docs/api/index.md << EOF
          # API Reference
          
          This section contains the API documentation for the DataVerse-ChatBot project.
          EOF
          
          # Create chatbot module documentation
          cat > docs/api/chatbot.md << EOF
          # Chatbot Module
          
          \`\`\`python
          from src.chatbot import config
          \`\`\`
          
          ::: src.chatbot.config
              options:
                  show_source: true
          
          \`\`\`python
          from src.chatbot import crawler
          \`\`\`
          
          ::: src.chatbot.crawler
              options:
                  show_source: true
                  
          \`\`\`python
          from src.chatbot import voice_mode
          \`\`\`
          
          ::: src.chatbot.voice_mode
              options:
                  show_source: true
          EOF
          
          # Create RAG module documentation
          cat > docs/api/rag.md << EOF
          # RAG Module
          
          \`\`\`python
          from src.chatbot.rag import base_rag
          \`\`\`
          
          ::: src.chatbot.rag.base_rag
              options:
                  show_source: true
          
          \`\`\`python
          from src.chatbot.rag import claude_rag
          \`\`\`
          
          ::: src.chatbot.rag.claude_rag
              options:
                  show_source: true
                  
          \`\`\`python
          from src.chatbot.rag import cohere_rag
          \`\`\`
          
          ::: src.chatbot.rag.cohere_rag
              options:
                  show_source: true
                  
          \`\`\`python
          from src.chatbot.rag import deepseek_rag
          \`\`\`
          
          ::: src.chatbot.rag.deepseek_rag
              options:
                  show_source: true
                  
          \`\`\`python
          from src.chatbot.rag import gemini_rag
          \`\`\`
          
          ::: src.chatbot.rag.gemini_rag
              options:
                  show_source: true
                  
          \`\`\`python
          from src.chatbot.rag import grok_rag
          \`\`\`
          
          ::: src.chatbot.rag.grok_rag
              options:
                  show_source: true
                  
          \`\`\`python
          from src.chatbot.rag import mistral_rag
          \`\`\`
          
          ::: src.chatbot.rag.mistral_rag
              options:
                  show_source: true
                  
          \`\`\`python
          from src.chatbot.rag import openai_rag
          \`\`\`
          
          ::: src.chatbot.rag.openai_rag
              options:
                  show_source: true
          EOF
          
          # Create Embeddings module documentation
          cat > docs/api/embeddings.md << EOF
          # Embeddings Module
          
          \`\`\`python
          from src.chatbot.embeddings import base_embedding
          \`\`\`
          
          ::: src.chatbot.embeddings.base_embedding
              options:
                  show_source: true
          EOF
          
          # Create Utils module documentation
          cat > docs/api/utils.md << EOF
          # Utils Module
          
          \`\`\`python
          from src.chatbot.utils import file_loader
          \`\`\`
          
          ::: src.chatbot.utils.file_loader
              options:
                  show_source: true
          
          \`\`\`python
          from src.chatbot.utils import inference
          \`\`\`
          
          ::: src.chatbot.utils.inference
              options:
                  show_source: true
                  
          \`\`\`python
          from src.chatbot.utils import make_dataset
          \`\`\`
          
          ::: src.chatbot.utils.make_dataset
              options:
                  show_source: true
                  
          \`\`\`python
          from src.chatbot.utils import monitor_service
          \`\`\`
          
          ::: src.chatbot.utils.monitor_service
              options:
                  show_source: true
                  
          \`\`\`python
          from src.chatbot.utils import paths
          \`\`\`
          
          ::: src.chatbot.utils.paths
              options:
                  show_source: true
                  
          \`\`\`python
          from src.chatbot.utils import train_clf
          \`\`\`
          
          ::: src.chatbot.utils.train_clf
              options:
                  show_source: true
                  
          \`\`\`python
          from src.chatbot.utils import utils
          \`\`\`
          
          ::: src.chatbot.utils.utils
              options:
                  show_source: true
          EOF
          
          # Create Web module documentation
          cat > docs/api/web.md << EOF
          # Web Module
          
          \`\`\`python
          from src.web import chat_web_app
          \`\`\`
          
          ::: src.web.chat_web_app
              options:
                  show_source: true
                  
          \`\`\`python
          from src.web import chat_web_template
          \`\`\`
          
          ::: src.web.chat_web_template
              options:
                  show_source: true
          EOF

      - name: Build documentation
        run: |
          mkdocs build

      - name: Deploy to GitHub Pages
        uses: JamesIves/github-pages-deploy-action@v4
        with:
          folder: site
          branch: gh-pages
